#!/usr/bin/env bash
(set -o igncr) 2>/dev/null && set -o igncr; # cygwin encoding fix

# fight simlinks and avoid readlink -f which doesn't exist on Darwin and Solaris
pushd . > /dev/null
basedir="${BASH_SOURCE[0]}";
while([ -h "${basedir}" ]); do
    cd "`dirname "${basedir}"`"
    basedir="$(readlink "`basename "${basedir}"`")";
done
cd "`dirname "${basedir}"`" > /dev/null
basedir="`pwd`";
popd  > /dev/null

case `uname` in
    *CYGWIN*) basedir=`cygpath -w "$basedir"`;;
esac

JAVA_EXE="$JAVA_HOME/bin/java"
if ! [[ -x "$JAVA_EXE" ]]; then
  JAVA_EXE=java
fi

if [[ -d "$basedir/../.jvmci" ]]; then
  JVMCI="--module-path=$basedir/../.jvmci -XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI --upgrade-module-path=$basedir/../.jvmci/compiler.jar"
fi

if [[ -f "$basedir/../../security.policy" ]]; then
  SECURITY_MANAGER="-Djava.security.manager -Djava.security.policy=$basedir/../../security.policy"
fi

if [[ -f "$basedir/../../logging.properties" ]]; then
  LOGGING_PROPERTIES="-Djava.util.logging.config.file=$basedir/../../logging.properties"
fi

exec "$JAVA_EXE" -XX:+IgnoreUnrecognizedVMOptions $JVMCI $SECURITY_MANAGER $LOGGING_PROPERTIES $JAVA_OPTS -jar "$basedir/es4x-launcher.jar" "$@"
